#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# Script to create supported.txt files for ESM. It can also be used for
# updating current existing supported.txt files.
#
# Author: Eduardo Barretto <eduardo.barretto@canonical.com>
# Copyright (C) 2024 Canonical Ltd.
#
# This script is distributed under the terms and conditions of the GNU General
# Public License, Version 3 or later. See http://www.gnu.org/copyleft/gpl.html
# for details.
#


import argparse
import source_map

def main():
    parser = argparse.ArgumentParser(description='Generate a supported.txt for a given release')
    parser.add_argument('-r', '--release', required=True, action='store',
                        type=str, help='Ubuntu Release coname')
    parser.add_argument('-p', '--product', required=True,
                        choices=['esm-infra', 'esm-apps'],
                        help='Product name, e.g. esm-apps or esm-infra')
    args = parser.parse_args()

    sections = ['main', 'restricted']
    if args.product == 'esm-apps':
        sections = ['universe', 'multiverse']

    srcmap = source_map.load()

    filename = f"{args.product}-{args.release}-supported.txt"
    with open(filename, 'w+') as f:
        for pkg in sorted(srcmap[args.release]):
            if srcmap[args.release][pkg]['section'] in sections:
                f.write(pkg + '\n')

    print(f"{filename} created!")

if __name__ == '__main__':
    main()
