# Datalib

## Intro

Datalib is a project that aims to represent the common objects in vulnerability management
into a library that can be used and adjust to interact with them through standard interfaces.

## Structure

The main two structures in datalib are:

* **Models**: contain the classes that represent the objects themselves.
* **Storage**: contains the classes that take care of loading, unloading and access to the objects themselves.
  They follow a lazy loading approach, binding the objects together when accessed.

The philosophy is that the object exist with references to the other objects.
When the user wants to access an object, the storage class will inspect the state
of the rest of storage classes to link the requested object with the appropriate ones.

For example:

> user requests to the CVE storage for the object CVE-0001-0001 which affects pkg1 and pkg2.
>CVE storage will then ask Package storage for those packages. Package storage only has 
>loaded pkg1 because pkg2 no longer exists. The returned CVE-0001-0001 will only have one 
>package entry pointing to pkg1.

This approach allows:

* More modularity since object will be loaded with the available existing information.
* Less memory usage since that allows more granular loading from disk.
* Faster loading times since there is no need to find the right relations between objects unless accessed.

## Implementation

Datalib is not meant to be used as is, since the classes and functions represent
generic objects. In order to be used with a specific set of CVEs, packages and security
notices, the user will need to implement the required specifics for the objects and data
sources given the project.

### UCT

`uct_models.py` and `uct_storage.py` contain the specific implementations of
datalib for the UCT project.

The objects have been adapted to relate around a new object: Release.

Examples:

#### Load everything

```python
release_storage = ReleaseStorage()
cve_storage = UCTCVEStorage()
cve_storage.link_release_storage(release_storage)
cve_storage.load()

package_storage = UCTPackageStorage()
package_storage.link_release_storage(release_storage)
package_storage.load()

usn_storage = USNStorage()
usn_storage.link_release_storage(release_storage)
usn_storage.load()

cve_storage.link_pkg_storage(package_storage)
usn_storage.link_pkg_storage(package_storage)
usn_storage.link_cve_storage(cve_storage)
```

#### Get objects

```python
release_storage.get_release(release_name)
cve_storage.get_cve(cve_id)
package_storage.get_pkg(pkg_name)
usn_storage.get_usn(usn_id)
```
